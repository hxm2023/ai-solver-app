# ğŸš€ æ²æ¢§AI V25.1 - MySQLæ•°æ®åº“ç‰ˆæœ¬å¿«é€Ÿéƒ¨ç½²

## âœ… å½“å‰è¿›åº¦

### å·²å®Œæˆ (2/8)
1. âœ… æ•°æ®åº“è¿æ¥æ¨¡å— (`database.py`)
2. âœ… ç”¨æˆ·è®¤è¯API (`auth_api.py`)
3. âœ… SQLè¡¨ç»“æ„æ‰©å±•è„šæœ¬ (`database_schema_upgrade.sql`)
4. âœ… å®Œæ•´ä½¿ç”¨æ–‡æ¡£ (`V25.1_MySQLæ•°æ®åº“é›†æˆæŒ‡å—.md`)

### å¾…å®Œæˆ (6/8)
- â³ æ•°æ®è¿ç§»å·¥å…·
- â³ APIç«¯ç‚¹é›†æˆ
- â³ å‰ç«¯ç™»å½•ç•Œé¢
- â³ å®Œæ•´æµ‹è¯•

---

## ğŸ“‹ ç«‹å³æ‰§è¡Œï¼ˆæŒ‰é¡ºåºï¼‰

### âœ¨ æ­¥éª¤1ï¼šå®‰è£…Pythonä¾èµ–

**åŒå‡»è¿è¡Œï¼š**
```
ã€å®‰è£…ã€‘MySQLæ•°æ®åº“ä¾èµ–.bat
```

**æˆ–æ‰‹åŠ¨æ‰§è¡Œï¼š**
```bash
cd backend
venv\Scripts\activate
pip install pymysql cryptography pyjwt
```

---

### âœ¨ æ­¥éª¤2ï¼šæ‰§è¡Œæ•°æ®åº“è¡¨ç»“æ„å‡çº§

**åœ¨Navicatä¸­æ‰§è¡ŒSQLè„šæœ¬ï¼š**

1. æ‰“å¼€Navicat Premium
2. è¿æ¥æ•°æ®åº“ï¼š
   - **ä¸»æœºï¼š** 14.103.127.20
   - **ç«¯å£ï¼š** 3306
   - **ç”¨æˆ·ï¼š** root
   - **å¯†ç ï¼š** Jiuzhi#2024
   - **æ•°æ®åº“ï¼š** edu

3. æ‰“å¼€æŸ¥è¯¢çª—å£ï¼Œæ‰¾åˆ°å¹¶æ‰§è¡Œæ–‡ä»¶ï¼š
   ```
   backend/database_schema_upgrade.sql
   ```

4. æ‰§è¡Œåï¼ŒéªŒè¯è¡¨ç»“æ„ï¼š
   ```sql
   USE edu;
   DESC subject;
   DESC exam;
   DESC user_exam;
   DESC user;
   ```

**å…³é”®æ–°å¢å­—æ®µï¼š**
- `subjectè¡¨`: subject_type, difficulty, knowledge_points, subject_name, grade, answer, explanation
- `examè¡¨`: exam_type, created_at
- `user_examè¡¨`: answered_at, user_answer, status

---

### âœ¨ æ­¥éª¤3ï¼šæµ‹è¯•æ•°æ®åº“è¿æ¥

```bash
cd backend
venv\Scripts\activate
python database.py
```

**é¢„æœŸçœ‹åˆ°ï¼š**
```
======================================================================
ã€æ•°æ®åº“è¿æ¥æµ‹è¯•ã€‘
======================================================================
âœ… æ•°æ®åº“è¿æ¥æ± åˆå§‹åŒ–æˆåŠŸ (5ä¸ªè¿æ¥)
âœ… MySQLç‰ˆæœ¬: {'VERSION()': '8.0.x'}
âœ… æ•°æ®åº“è¡¨: ['exam', 'subject', 'user', 'user_exam']

âœ… æ•°æ®åº“æ¨¡å—æ­£å¸¸
```

---

### âœ¨ æ­¥éª¤4ï¼šæµ‹è¯•ç”¨æˆ·è®¤è¯

```bash
python auth_api.py
```

**é¢„æœŸçœ‹åˆ°ï¼š**
```
ç”Ÿæˆçš„ä»¤ç‰Œ: eyJ0eXAiOiJKV1QiLCJhbGc...
ä»¤ç‰ŒéªŒè¯æˆåŠŸ: {'user_id': 'test_user_123', ...}
```

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½æ¼”ç¤º

### 1. ç”¨æˆ·æ³¨å†Œ
```python
from database import UserManager

result = UserManager.register("å¼ ä¸‰", "password123")
print(result)
# {'success': True, 'user_id': '...', 'message': 'æ³¨å†ŒæˆåŠŸ'}
```

### 2. ç”¨æˆ·ç™»å½•
```python
result = UserManager.login("å¼ ä¸‰", "password123")
print(result)
# {'success': True, 'user_id': '...', 'account': 'å¼ ä¸‰', 'message': 'ç™»å½•æˆåŠŸ'}
```

### 3. åˆ›å»ºé¢˜ç›®
```python
from database import SubjectManager

subject_id = SubjectManager.create_subject(
    subject_title="å¦‚å›¾æ‰€ç¤ºï¼Œæ¤­åœ†C: xÂ²/aÂ² + yÂ²/bÂ² = 1...",
    subject_desc="è§£æå‡ ä½• - ç¦»å¿ƒç‡",
    image_url="http://example.com/ellipse.jpg",
    solve="è¯¦ç»†è§£ç­”..."
)
```

### 4. åˆ›å»ºè¯•å·å¹¶å…³è”é¢˜ç›®
```python
from database import ExamManager

# åˆ›å»ºé”™é¢˜æœ¬
exam_id = ExamManager.create_exam(
    exam_title="å¼ ä¸‰çš„æ•°å­¦é”™é¢˜æœ¬",
    exam_content="è®°å½•å­¦ç”Ÿçš„æ•°å­¦é”™é¢˜"
)

# å…³è”ç”¨æˆ·-è¯•å·-é¢˜ç›®
ExamManager.link_user_exam_subject(
    user_id="...",
    exam_id=exam_id,
    subject_id=subject_id
)
```

### 5. è·å–ç”¨æˆ·æ•°æ®
```python
# è·å–ç”¨æˆ·çš„æ‰€æœ‰é¢˜ç›®
subjects = SubjectManager.get_user_subjects(user_id)

# è·å–ç”¨æˆ·çš„æ‰€æœ‰è¯•å·
exams = ExamManager.get_user_exams(user_id)

# è·å–ç‰¹å®šè¯•å·çš„é¢˜ç›®
subjects = SubjectManager.get_user_subjects(user_id, exam_id)
```

---

## ğŸ“Š æ•°æ®å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   user   â”‚
â”‚  (ç”¨æˆ·)   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 1:N
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      N:M      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  user_exam  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  subject â”‚
â”‚ (ç­”é¢˜è®°å½•)   â”‚                â”‚  (é¢˜ç›®)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ N:1
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   exam  â”‚
â”‚ (è¯•å·)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” å®‰å…¨é…ç½®

### å½“å‰é…ç½®ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
```python
# JWTå¯†é’¥
JWT_SECRET_KEY = "muwu_ai_solver_secret_key_2024"

# å¯†ç ç›å€¼
SALT = "muwu_ai_solver_2024"
```

### âš ï¸ ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹
åœ¨ `auth_api.py` å’Œ `database.py` ä¸­ï¼Œå°†å¯†é’¥å’Œç›å€¼æ”¹ä¸ºç¯å¢ƒå˜é‡ï¼š

```python
import os
JWT_SECRET_KEY = os.getenv("JWT_SECRET_KEY", "é»˜è®¤å€¼")
SALT = os.getenv("PASSWORD_SALT", "é»˜è®¤å€¼")
```

---

## ğŸ“ åç»­å¼€å‘æ¸…å•

### ä¸‹ä¸€æ­¥ï¼šæ•°æ®è¿ç§»å·¥å…·
åˆ›å»ºè„šæœ¬å°†ç°æœ‰JSONæ•°æ®å¯¼å…¥MySQLï¼š
- `simple_data/mistakes.json` â†’ `subject` è¡¨ï¼ˆsubject_type='mistake'ï¼‰
- `simple_data/generated_questions.json` â†’ `subject` è¡¨ï¼ˆsubject_type='generated'ï¼‰

### å†ä¸‹ä¸€æ­¥ï¼šAPIé›†æˆ
åœ¨ `main_simple.py` ä¸­ï¼š
1. å¯¼å…¥ `auth_router`ï¼Œæ³¨å†Œè®¤è¯è·¯ç”±
2. æ‰€æœ‰APIç«¯ç‚¹æ·»åŠ  `user: dict = Depends(get_current_user)`
3. å°†JSONè¯»å†™æ”¹ä¸ºæ•°æ®åº“æ“ä½œ

### æœ€åï¼šå‰ç«¯ç™»å½•ç•Œé¢
åœ¨ `SimpleMistakeBook.tsx` ä¸­ï¼š
1. æ·»åŠ ç™»å½•/æ³¨å†Œè¡¨å•
2. ç™»å½•æˆåŠŸåä¿å­˜JWTä»¤ç‰Œ
3. æ‰€æœ‰è¯·æ±‚æºå¸¦ `Authorization: Bearer <token>`

---

## ğŸ› ï¸ å¸¸ç”¨å‘½ä»¤

### æ•°æ®åº“æ“ä½œ
```bash
# æµ‹è¯•è¿æ¥
python database.py

# æµ‹è¯•è®¤è¯
python auth_api.py

# æŸ¥çœ‹è¡¨ç»“æ„
mysql -h 14.103.127.20 -u root -p edu
> DESC subject;
```

### å¯åŠ¨æœåŠ¡
```bash
# å¯åŠ¨åç«¯ï¼ˆæš‚æ—¶è¿˜æ˜¯JSONç‰ˆæœ¬ï¼‰
cd backend
venv\Scripts\activate
python -m uvicorn main_simple:app --reload --host 127.0.0.1 --port 8000

# å¯åŠ¨å‰ç«¯
cd frontend\vite-project
npm run dev
```

---

## ğŸ› é—®é¢˜æ’æŸ¥

### 1. pymysqlå¯¼å…¥é”™è¯¯
```bash
pip install pymysql cryptography
```

### 2. æ•°æ®åº“è¿æ¥è¶…æ—¶
æ£€æŸ¥ç½‘ç»œï¼Œç¡®ä¿èƒ½è®¿é—® 14.103.127.20:3306

### 3. JWTä»¤ç‰ŒéªŒè¯å¤±è´¥
æ£€æŸ¥å‰ç«¯è¯·æ±‚å¤´ï¼š
```javascript
headers: {
    'Authorization': `Bearer ${token}`
}
```

---

## ğŸ“ ä¸‹ä¸€æ­¥æ“ä½œ

**å®Œæˆä¸Šè¿°4ä¸ªæ­¥éª¤åï¼Œå‘Šè¯‰æˆ‘ï¼š**
1. âœ… ä¾èµ–æ˜¯å¦å®‰è£…æˆåŠŸï¼Ÿ
2. âœ… SQLè„šæœ¬æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Ÿï¼ˆDESC subject çœ‹åˆ°æ–°å­—æ®µï¼‰
3. âœ… æ•°æ®åº“è¿æ¥æµ‹è¯•æ˜¯å¦é€šè¿‡ï¼Ÿ
4. âœ… è®¤è¯æµ‹è¯•æ˜¯å¦é€šè¿‡ï¼Ÿ

**å…¨éƒ¨é€šè¿‡åï¼Œæˆ‘ä¼šç»§ç»­å¼€å‘ï¼š**
- æ•°æ®è¿ç§»å·¥å…·
- APIé›†æˆ
- å‰ç«¯ç™»å½•ç•Œé¢

---

**ç‰ˆæœ¬ï¼šV25.1**  
**æ›´æ–°æ—¶é—´ï¼š2025å¹´10æœˆ25æ—¥**  
**çŠ¶æ€ï¼šğŸŸ¡ åŸºç¡€æ¨¡å—å®Œæˆï¼Œå¾…é›†æˆæµ‹è¯•**

