# V23.0 快速测试指南

## 🚀 快速开始

### 启动服务

**后端**:
```bash
cd backend
python main.py
```

**前端**:
```bash
cd frontend/vite-project
npm run dev
```

---

## ✅ 核心功能验证

### 测试1: 图像增强功能

**准备图片**: 一张稍微模糊或光照不均的题目照片

**步骤**:
1. 上传图片
2. 选择"解答模式" → "单题解答"
3. 点击"开始解题"

**观察后端日志**:
```
✓ 应该看到:
[图像增强] 🚀 启动高级预处理流水线 (模式: standard)
[图像增强] → 应用锐化处理...
[图像增强] ✓ 锐化完成
[图像增强] → 应用CLAHE对比度增强...
[图像增强] ✓ CLAHE增强完成
[图像增强] ✅ 预处理流水线完成！
```

**验证点**:
- [ ] 日志中出现图像增强相关信息
- [ ] OCR识别成功
- [ ] AI回答准确

---

### 测试2: AI智能校正

**准备图片**: 包含容易混淆字符的题目（如数字1和字母l）

**步骤**:
1. 上传图片
2. 开始解题

**观察AI回答**:
- [ ] AI能正确识别混淆的字符
- [ ] 回答中**不提及**"OCR错误"、"识别失败"等技术词汇
- [ ] 回答流畅自然，像老师在讲解

**如果OCR错了，AI应该自己修正**:
```
❌ 不应该出现:
"根据OCR识别结果，这道题是..."（然后按错误的结果讲解）

✅ 应该是:
"这道题考查的是..."（直接按图片中正确的内容讲解）
```

---

### 测试3: 快捷按钮

**步骤**:
1. 完成第一次回答后
2. 观察输入框上方是否出现两个按钮:
   - 🔵 "▶️ 请继续回答"
   - 🔴 "🔍 请检查是否有错误"

**验证点**:
- [ ] 按钮出现
- [ ] 按钮有悬浮动画效果
- [ ] 点击按钮后自动发送对应消息
- [ ] 点击后按钮消失
- [ ] 手动输入后按钮也消失

---

### 测试4: 图片质量检测（前端）

**测试小图片**:
1. 准备一张 < 300x300 的图片
2. 尝试上传

**预期**:
```
⚠️ 图片尺寸过小，可能无法清晰识别。
建议使用更高分辨率的图片（至少300x300像素）。
```

**测试大文件**:
1. 准备一张 > 10MB 的图片
2. 尝试上传

**预期**:
```
⚠️ 图片文件过大（超过10MB）。
建议压缩后再上传，以提升处理速度。
```

---

### 测试5: 追问功能（含图片记忆）

**步骤**:
1. 完成第一次回答
2. 追问："那第二小题呢？"

**观察后端日志**:
```
✓ 应该看到:
[追问模式] 开始重新构建对话历史...
[追问模式] ✓ 找到原始图片，大小: XXXXX 字符
[追问模式] ✓ 历史记录数: 2
[追问模式] ✓ 第1条消息已构建（包含图片）
[追问模式] ✓ 第2条消息已添加 (assistant)
[追问模式] ✓ 第3条消息已添加（当前追问）
[追问模式] ✅ 对话历史重建完成！
[追问模式] 📊 总消息数: 3 条
[追问模式] 📷 图片位置: 第1条消息中
```

**验证点**:
- [ ] 追问时日志显示"包含图片"
- [ ] AI能引用图片中的具体内容
- [ ] AI回答准确，无幻觉

---

## 🎯 高级测试场景

### 场景A: 模糊图片

**图片特征**: 拍照时焦距不准，文字略微模糊

**预期效果**:
- V23.0 应该通过锐化处理提升识别率
- OCR能正确识别大部分文字
- AI如发现少量OCR错误会自动修正

---

### 场景B: 光照不均

**图片特征**: 一边亮一边暗，或者有阴影

**预期效果**:
- CLAHE会均衡亮度
- 暗部文字能被正确识别

---

### 场景C: 复杂公式

**图片特征**: 包含复杂的数学公式（分式、根号、积分等）

**预期效果**:
- Pix2Text将公式转为LaTeX
- AI能理解并正确解答
- 前端MathJax正确渲染公式

---

### 场景D: 手写笔记

**图片特征**: 打印题目 + 手写答案

**预期效果**:
- 批改模式下
- AI能识别手写内容（可能不完美）
- 给出批改意见

---

## 🐛 常见问题排查

### 问题1: 图像增强日志没出现

**可能原因**:
- 代码更新后没重启后端
- `image_enhancer.py` 文件路径不对

**解决**:
```bash
# 停止后端 (Ctrl+C)
cd backend
python main.py  # 重新启动
```

---

### 问题2: 导入错误 "No module named 'cv2'"

**原因**: OpenCV未安装

**解决**:
```bash
cd backend
pip install opencv-python-headless
```

---

### 问题3: AI仍然提及"OCR错误"

**原因**: Prompt可能没更新

**检查**:
- `main.py` 中的 `enhanced_prompt` 是否为V23.0版本
- 重启后端

---

### 问题4: 快捷按钮不出现

**可能原因**:
- 前端代码未更新
- `showQuickButtons` 状态没正确触发

**检查**:
- 浏览器刷新前端 (Ctrl+Shift+R 强制刷新)
- 检查开发者工具Console是否有错误

---

### 问题5: 追问时报错 "会话不存在"

**原因**: Session被意外清除

**解决**:
- 点击"返回"重新开始
- 检查后端是否重启过（重启会清空内存中的SESSIONS）

---

## 📊 性能基准

### 正常的处理时间

| 操作 | 时间范围 | 说明 |
|------|---------|------|
| 前端质量检测 | < 1秒 | 即时反馈 |
| 图像增强 | 1-3秒 | 取决于图片大小 |
| OCR识别 | 5-20秒 | 首次加载模型较慢 |
| AI回答 | 10-30秒 | 取决于答案长度 |
| 总计（首次） | 20-50秒 | 包含模型加载 |
| 总计（后续） | 15-35秒 | 模型已加载 |

### 如果超时...

**OCR超过30秒**:
- 图片可能过大，尝试压缩
- 服务器性能不足

**AI回答超过60秒**:
- 网络问题
- API限流
- 检查dashscope API状态

---

## ✅ 完整测试清单

### 基础功能
- [ ] 后端正常启动（看到V23.0版本信息）
- [ ] 前端正常启动
- [ ] 图片上传成功
- [ ] OCR识别成功

### V23.0 新功能
- [ ] 图像增强流程运行（日志可见）
- [ ] 锐化处理完成
- [ ] CLAHE增强完成
- [ ] AI智能校正（不提及技术细节）
- [ ] 降级策略（如果增强失败）

### 前端新功能
- [ ] 快捷按钮显示
- [ ] 按钮点击工作
- [ ] 按钮动画效果
- [ ] 图片质量检测（尺寸、大小）

### V22.0 功能保持
- [ ] 追问带图片（日志可见）
- [ ] 续答功能（如果答案长）
- [ ] 会话持久化

### 用户体验
- [ ] 公式正确渲染（MathJax）
- [ ] 错误提示友好
- [ ] 界面流畅无卡顿

---

## 🎉 测试通过标准

**全部以下条件满足，即为测试通过**:

1. ✅ 图像增强日志正常输出
2. ✅ OCR识别准确率明显提升（对比V22.0）
3. ✅ AI回答中无技术细节暴露
4. ✅ 快捷按钮正常工作
5. ✅ 图片质量检测有效
6. ✅ 追问功能正常（含图片）
7. ✅ 性能在可接受范围内
8. ✅ 无崩溃或严重错误

---

**测试版本**: V23.0  
**测试重点**: 图像增强 + AI智能校正  
**预计测试时间**: 20-30分钟

