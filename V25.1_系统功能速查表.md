# 📋 V25.1 系统功能速查表

## 🎯 快速导航

| 功能模块 | JSON版本 | 数据库版本 | 说明 |
|---------|---------|-----------|------|
| 访问地址 | http://localhost:5173/ | http://localhost:5173/?mode=db | URL参数区分 |
| 用户认证 | ❌ | ✅ | 数据库版需要登录 |
| 错题管理 | ✅ | ✅ | 两版本都支持 |
| 智能出题 | ✅ | ⏳ | 数据库版开发中 |
| PDF导出 | ✅ | ⏳ | 数据库版开发中 |
| 网络辅助出题 | ✅ | ⏳ | 数据库版开发中 |
| 多用户支持 | ❌ | ✅ | 数据库版核心优势 |
| 数据持久化 | 📄 JSON | 🗄️ MySQL | 数据库更安全 |

---

## 🔗 系统端点速查

### 前端访问地址

| 模式 | URL | 说明 |
|-----|-----|------|
| JSON版本 | http://localhost:5173/ | 默认，无需登录 |
| 数据库版本 | http://localhost:5173/?mode=db | 需要登录 |
| 旧版界面 | http://localhost:5173/?mode=old | 原解题界面 |
| 带登录界面 | http://localhost:5173/?mode=new | MainApp组件 |

### 后端API地址

| 服务 | 端口 | 文档地址 |
|-----|------|---------|
| JSON版本后端 | 8000 | http://127.0.0.1:8000/docs |
| 数据库版本后端 | 8000 | http://127.0.0.1:8000/docs |

**注意：** 两个后端共用同一端口，需要根据启动脚本选择：
- `【启动】简化版错题本系统.bat` → JSON版本（main_simple.py）
- `【启动】数据库版本系统.bat` → 数据库版本（main_db.py）

---

## 🗄️ 数据库连接信息

```python
HOST = "14.103.127.20"
PORT = 3306
USER = "root"
PASSWORD = "Jiuzhi#2024"
DATABASE = "edu"
```

**Navicat连接步骤：**
1. 新建MySQL连接
2. 填入上述信息
3. 点击"测试连接"
4. 连接成功后可查看表结构和数据

---

## 📊 数据库表结构

### user表（用户表）
```sql
主键：user_id (VARCHAR 100)
字段：
  - account (VARCHAR 50) - 账号
  - password_hash (VARCHAR 256) - 密码哈希
  - nickname (VARCHAR 50) - 昵称
  - created_at (DATETIME) - 注册时间
```

### exam表（试卷表）
```sql
主键：exam_id (VARCHAR 100)
字段：
  - exam_title (VARCHAR 100) - 标题
  - exam_content (TEXT) - 内容
  - exam_type (VARCHAR 50) - 类型（mistake_book/practice_set/custom）
  - created_at (DATETIME) - 创建时间
```

### subject表（题目表）
```sql
主键：subject_id (VARCHAR 100)
字段：
  - subject_title (LONGTEXT) - 题目内容
  - subject_desc (LONGTEXT) - 描述
  - image_url (TEXT) - 图片URL/Base64
  - solve (LONGTEXT) - 解答
  - subject_type (VARCHAR 50) - 类型（mistake/generated）
  - difficulty (VARCHAR 20) - 难度
  - knowledge_points (TEXT) - 知识点JSON
  - subject_name (VARCHAR 50) - 学科
  - grade (VARCHAR 20) - 年级
  - answer (LONGTEXT) - 答案
  - explanation (LONGTEXT) - 解析
  - created_at/updated_at (DATETIME) - 时间戳
```

### user_exam表（用户答题记录）
```sql
主键：id (VARCHAR 100)
字段：
  - user_info (VARCHAR 100) - 用户ID
  - subject_id (VARCHAR 100) - 题目ID
  - exam_id (VARCHAR 100) - 试卷ID
  - answered_at (DATETIME) - 答题时间
  - user_answer (TEXT) - 用户答案
  - status (VARCHAR 20) - 状态（unanswered/correct/incorrect）
```

---

## 🔐 API认证端点

### 用户注册
```http
POST /auth/register
Content-Type: application/json

{
  "account": "username",
  "password": "password123",
  "nickname": "昵称"
}

响应：
{
  "success": true,
  "message": "注册成功",
  "user_id": "uuid"
}
```

### 用户登录
```http
POST /auth/login
Content-Type: application/json

{
  "account": "username",
  "password": "password123"
}

响应：
{
  "access_token": "eyJ...",
  "token_type": "bearer",
  "user_info": {
    "user_id": "uuid",
    "account": "username",
    "nickname": "昵称"
  }
}
```

### 验证令牌
```http
GET /auth/verify
Authorization: Bearer eyJ...

响应：
{
  "valid": true,
  "user_info": {...}
}
```

### 获取当前用户
```http
GET /auth/me
Authorization: Bearer eyJ...

响应：
{
  "user_id": "uuid",
  "account": "username",
  "nickname": "昵称",
  "created_at": "2025-10-25T..."
}
```

---

## 📝 错题本API

### 获取错题列表
```http
GET /mistakes/?subject=数学&grade=高一&limit=10&offset=0
Authorization: Bearer eyJ...

响应：
{
  "total": 5,
  "items": [
    {
      "id": "uuid",
      "question_text": "...",
      "wrong_answer": "...",
      "ai_analysis": "...",
      "subject": "数学",
      "grade": "高一",
      "knowledge_points": ["..."],
      "created_at": "2025-10-25T..."
    }
  ],
  "offset": 0,
  "limit": 10
}
```

### 创建错题
```http
POST /mistakes/
Authorization: Bearer eyJ...
Content-Type: application/json

{
  "image_base64": "iVBORw0KG...",
  "question_text": "...",
  "wrong_answer": "...",
  "ai_analysis": "...",
  "subject": "数学",
  "grade": "高一",
  "knowledge_points": ["不等式", "函数"]
}
```

### 删除错题
```http
DELETE /mistakes/{mistake_id}
Authorization: Bearer eyJ...

响应：
{
  "success": true,
  "message": "删除成功"
}
```

### 获取统计信息
```http
GET /mistakes/stats/summary
Authorization: Bearer eyJ...

响应：
{
  "total_mistakes": 5,
  "subjects": {
    "数学": 3,
    "英语": 2
  },
  "grades": {
    "高一": 3,
    "高二": 2
  },
  "top_knowledge_points": [
    ["不等式", 2],
    ["函数", 1]
  ]
}
```

---

## 📚 题目库API

### 获取题目列表
```http
GET /questions/?subject=数学&grade=高一&limit=10&offset=0
Authorization: Bearer eyJ...
```

### 生成题目
```http
POST /questions/generate
Authorization: Bearer eyJ...
Content-Type: application/json

{
  "mistake_ids": ["uuid1", "uuid2"],
  "count": 3,
  "difficulty": "中等",
  "allow_web_search": false
}
```

### 删除题目
```http
DELETE /questions/{question_id}
Authorization: Bearer eyJ...
```

---

## 🎨 前端组件结构

```
src/
├── SimpleMistakeBook.tsx          # JSON版本主界面
├── SimpleMistakeBookDB.tsx        # 数据库版本主界面（新增）
├── SimpleMistakeBook.css          # 通用样式
├── SimpleMistakeBookDB.css        # 数据库版本样式（新增）
├── components/
│   ├── QuestionItem.tsx           # 题目渲染组件（LaTeX支持）
│   ├── AuthModal.tsx              # 登录/注册模态框（新增）
│   └── AuthModal.css              # 认证组件样式（新增）
└── utils/
    └── api.ts                     # API请求工具（新增）
```

---

## 🛠️ 启动脚本一览

| 脚本名称 | 功能 | 后端文件 |
|---------|------|---------|
| 【启动】简化版错题本系统.bat | JSON版本 | main_simple.py |
| 【启动】数据库版本系统.bat | 数据库版本 | main_db.py |
| 【修复】安装依赖到venv.bat | 安装Python依赖 | - |
| 【安装】MySQL数据库依赖.bat | 安装数据库依赖 | - |
| 【测试】数据库连接.bat | 测试数据库连接 | database.py |
| 【测试】用户认证.bat | 测试JWT认证 | auth_api.py |
| 【执行】数据迁移-简化版.bat | 数据迁移 | migrate_data.py |

---

## 🔄 数据迁移流程

```
JSON文件                    MySQL数据库
──────────                  ────────────

mistakes.json        →      subject表（subject_type='mistake'）
                             ↓
                            user_exam表（关联用户）
                             ↓
                            exam表（错题本试卷）

generated_questions.json →  subject表（subject_type='generated'）
                             ↓
                            user_exam表（关联用户）
                             ↓
                            exam表（练习题集试卷）
```

---

## 🧪 测试账号信息

### demo_user（预装数据）
```
账号：demo_user
密码：demo123456
用户ID：48fd341f-5917-4efa-a289-c3e3c854e251
错题数：5条
题目数：62条
总数据：67条
```

### 创建新账号
1. 访问 http://localhost:5173/?mode=db
2. 点击"立即注册"
3. 填写信息
4. 自动登录

---

## 📦 依赖版本

### Python后端
```txt
fastapi==0.104.1
uvicorn==0.24.0
python-multipart==0.0.6
python-dotenv==1.0.0
dashscope==1.14.1
pymysql==1.1.0
pyjwt==2.8.0
cryptography==41.0.7
pyppeteer==1.0.2
markdown==3.5.1
beautifulsoup4==4.12.2
requests==2.31.0
Pillow==10.1.0
```

### 前端
```json
{
  "react": "^18.2.0",
  "react-dom": "^18.2.0",
  "typescript": "^5.2.2",
  "vite": "^5.0.0",
  "marked": "^9.1.6",
  "axios": "^1.6.2"
}
```

---

## 🔍 故障排查

### 后端启动失败
1. 检查Python虚拟环境是否激活
2. 检查依赖是否完整安装
3. 检查端口8000是否被占用
4. 查看终端错误信息

### 数据库连接失败
1. 检查数据库服务器是否可访问
2. 检查用户名密码是否正确
3. 检查防火墙规则
4. 运行【测试】数据库连接.bat

### 前端登录失败
1. 检查后端是否启动
2. 检查网络请求是否正常（F12控制台）
3. 检查账号密码是否正确
4. 尝试注册新账号

### JWT令牌过期
1. 重新登录
2. 检查系统时间是否正确
3. 令牌有效期为24小时

---

## 📞 获取帮助

### 文档
- [V25.1_MySQL数据库集成完成报告.md](./V25.1_MySQL数据库集成完成报告.md)
- [V25.1_MySQL数据库集成指南.md](./V25.1_MySQL数据库集成指南.md)
- [【必读】V25.1数据库版本快速启动.md](./【必读】V25.1数据库版本快速启动.md)

### API文档
- http://127.0.0.1:8000/docs （启动后端后访问）

### 数据库工具
- Navicat Premium（推荐）
- MySQL Workbench
- phpMyAdmin

---

**保存本文档，随时查阅系统信息！** 📚

*最后更新：2025年10月25日 - V25.1*

