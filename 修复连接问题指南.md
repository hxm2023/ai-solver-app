# 🔧 修复 ERR_CONNECTION_REFUSED 连接问题

## 问题原因

前端显示 `ERR_CONNECTION_REFUSED` 错误，说明**后端服务没有成功启动**。

## 解决方案

### 方案1：使用批处理文件启动（推荐）

1. **双击运行**：`启动数据库后端.bat`
2. **等待看到**：`INFO: Application startup complete.`
3. **保持窗口开启**（不要关闭）
4. **访问前端**：`http://localhost:5173/?mode=db`

### 方案2：手动启动后端

打开新的命令提示符（cmd），依次执行：

```bash
cd backend
venv\Scripts\activate.bat
python -m uvicorn main_db:app --reload --host 127.0.0.1 --port 8000
```

### 方案3：使用完整启动脚本

双击运行：`【启动】数据库版本系统.bat`

这会同时启动前端和后端。

## 验证后端是否启动成功

### 方法1：检查窗口输出

后端启动成功会显示：

```
✅ 数据库连接池初始化成功 (5个连接)
INFO: Started server process [PID]
INFO: Waiting for application startup.
INFO: Application startup complete.
INFO: Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
```

### 方法2：浏览器测试

访问 `http://127.0.0.1:8000/docs`，如果能看到API文档页面，说明后端启动成功。

### 方法3：命令检查

打开新的cmd窗口，运行：

```bash
netstat -ano | findstr :8000
```

如果看到输出（类似 `TCP 127.0.0.1:8000 ... LISTENING`），说明后端正在运行。

## 常见问题

### Q1: 端口被占用

**错误信息**：`[Errno 10048] error while attempting to bind on address ('127.0.0.1', 8000)`

**解决方法**：

```bash
# 查找占用8000端口的进程
netstat -ano | findstr :8000

# 强制结束进程（PID是上一步查到的进程ID）
taskkill /F /PID <PID>
```

### Q2: Python/uvicorn找不到

**错误信息**：`'python' is not recognized...` 或 `'uvicorn' is not recognized...`

**解决方法**：

确保先激活虚拟环境：

```bash
cd backend
venv\Scripts\activate.bat
```

### Q3: 数据库连接失败

**错误信息**：`Can't connect to MySQL server...`

**解决方法**：

1. 检查MySQL服务是否启动
2. 检查数据库连接信息是否正确（`backend/database.py`）
3. 检查网络是否能访问 `14.103.127.20:3306`

## CORS配置已修复

后端的CORS配置已经更新，允许以下源访问：

- `http://localhost:5173`
- `http://127.0.0.1:5173`
- `http://localhost:3000`
- `http://127.0.0.1:3000`

## 完整启动步骤

1. **启动后端**：
   - 双击 `启动数据库后端.bat`
   - 等待看到 "Application startup complete"

2. **启动前端**（如果没有自动启动）：
   ```bash
   cd frontend\vite-project
   npm run dev
   ```

3. **访问系统**：
   - 前端界面：`http://localhost:5173/?mode=db`
   - API文档：`http://127.0.0.1:8000/docs`

4. **登录测试**：
   - 账号：`demo_user`
   - 密码：`demo123456`

## 需要帮助？

如果问题仍然存在，请检查：

1. ✅ 后端窗口是否显示启动成功
2. ✅ 浏览器控制台的具体错误信息
3. ✅ 数据库连接是否正常
4. ✅ 防火墙是否阻止了8000端口

---

**注意**：启动后端时，请保持命令窗口开启，不要关闭。关闭窗口会停止后端服务。

