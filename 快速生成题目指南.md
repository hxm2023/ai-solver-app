# 快速生成题目指南

## 🚀 最简单的方法：运行测试脚本

### 前提条件
1. 后端服务已启动
2. 已有测试账号（如果没有，脚本会提示）

### 操作步骤
```bash
# 1. 进入backend目录
cd backend

# 2. 运行Feature 3测试脚本
python test_feature3_question_gen.py
```

脚本会自动：
- ✅ 登录测试账号
- ✅ 创建3道测试错题
- ✅ 从错题中提炼知识点
- ✅ 生成题目（选择题+填空题）
- ✅ 显示生成的题目内容

---

## 📝 手动API调用方法

### Step 1: 登录获取Token
```bash
# Windows PowerShell
$response = Invoke-RestMethod -Uri "http://127.0.0.1:8000/auth/login" `
  -Method Post `
  -ContentType "application/json" `
  -Body '{"username": "test_student", "password": "password123"}'

$token = $response.access_token
Write-Host "Token获取成功: $token"
```

或者使用Postman/API工具：
```
POST http://127.0.0.1:8000/auth/login
Content-Type: application/json

{
  "username": "test_student",
  "password": "password123"
}

→ 复制返回的 access_token
```

---

### Step 2: 创建错题（准备数据）
```bash
# Windows PowerShell
$headers = @{
    "Authorization" = "Bearer $token"
    "Content-Type" = "application/json"
}

$mistakeData = @{
    question_text = "解方程 x² - 5x + 6 = 0"
    wrong_answer = "x = 1 或 x = 6"
    ai_analysis = "[MISTAKE_DETECTED] 错误！正确答案是 x=2 或 x=3"
    subject = "数学"
    knowledge_points = @("一元二次方程", "因式分解")
    difficulty = 2
} | ConvertTo-Json

$mistake = Invoke-RestMethod -Uri "http://127.0.0.1:8000/mistakes/" `
  -Method Post `
  -Headers $headers `
  -Body $mistakeData

Write-Host "错题ID: $($mistake.id)"
```

**或者在API文档中操作**：
访问 http://127.0.0.1:8000/docs
→ 找到 `POST /mistakes/`
→ 点击 "Try it out"
→ 填入数据并执行

---

### Step 3: 提炼知识点
```bash
# Windows PowerShell
$knowledgeData = @{
    mistake_ids = @(1, 2, 3)  # 使用你创建的错题ID
    subject = "数学"
} | ConvertTo-Json

$knowledge = Invoke-RestMethod -Uri "http://127.0.0.1:8000/ai-learning/generate_knowledge_points" `
  -Method Post `
  -Headers $headers `
  -Body $knowledgeData

Write-Host "提炼的知识点:"
$knowledge.knowledge_points | ForEach-Object { Write-Host "  - $_" }
```

**API文档操作**：
http://127.0.0.1:8000/docs
→ `POST /ai-learning/generate_knowledge_points`
→ 点击锁图标，输入Bearer Token
→ 填入错题ID和学科
→ 执行

---

### Step 4: 生成题目 🎯
```bash
# Windows PowerShell
$questionData = @{
    knowledge_points = @("一元二次方程", "因式分解")
    difficulty = "中等"
    question_types = @{
        "选择题" = 3
        "填空题" = 2
    }
    subject = "数学"
} | ConvertTo-Json -Depth 3

$result = Invoke-RestMethod -Uri "http://127.0.0.1:8000/ai-learning/generate_questions" `
  -Method Post `
  -Headers $headers `
  -Body $questionData

Write-Host "✅ 生成了 $($result.total_generated) 道题目"
Write-Host "耗时: $($result.generation_time)"
```

**API文档操作**：
http://127.0.0.1:8000/docs
→ `POST /ai-learning/generate_questions`
→ 填入：
```json
{
  "knowledge_points": ["一元二次方程", "因式分解"],
  "difficulty": "中等",
  "question_types": {
    "选择题": 3,
    "填空题": 2
  },
  "subject": "数学"
}
```
→ 执行

---

### Step 5: 查看生成的题目
```bash
# Windows PowerShell
$questions = Invoke-RestMethod -Uri "http://127.0.0.1:8000/ai-learning/my_questions" `
  -Headers $headers

Write-Host "我的题目库共有 $($questions.total) 道题目:"
$questions.questions | ForEach-Object {
    $content = $_.content | ConvertFrom-Json
    Write-Host ""
    Write-Host "题目类型: $($_.question_type)"
    Write-Host "题干: $($content.stem)"
    Write-Host "答案: $($_.answer)"
}
```

---

## 🎨 使用API文档界面（推荐）

### 最简单的可视化操作：

1. **打开API文档**
   ```
   http://127.0.0.1:8000/docs
   ```

2. **登录获取Token**
   - 找到 `POST /auth/login`
   - 点击 "Try it out"
   - 填入用户名密码
   - 点击 "Execute"
   - 复制返回的 `access_token`

3. **授权所有接口**
   - 点击页面右上角的 "Authorize" 按钮（🔓图标）
   - 输入：`Bearer your_token_here`
   - 点击 "Authorize"
   - 关闭弹窗

4. **创建错题**
   - 找到 `POST /mistakes/`
   - 点击 "Try it out"
   - 填入错题数据
   - 执行并记住返回的ID

5. **提炼知识点**
   - 找到 `POST /ai-learning/generate_knowledge_points`
   - 填入错题ID列表
   - 执行，查看AI提炼的知识点

6. **生成题目**
   - 找到 `POST /ai-learning/generate_questions`
   - 填入知识点、难度、题型
   - 执行，等待AI生成（10-30秒）

7. **查看题目**
   - 找到 `GET /ai-learning/my_questions`
   - 执行，查看所有生成的题目

---

## 🐛 常见问题

### Q1: 401 Unauthorized
**原因**：Token过期或未授权

**解决**：
1. 重新登录获取Token
2. 在API文档中点击"Authorize"重新授权

### Q2: 404 Not Found (错题或题目)
**原因**：ID不存在或属于其他用户

**解决**：
1. 使用 `GET /mistakes/` 查看自己的错题ID
2. 使用 `GET /ai-learning/my_questions` 查看自己的题目

### Q3: 500 Internal Server Error
**原因**：通义千问API调用失败

**解决**：
1. 检查后端日志
2. 确认DASHSCOPE_API_KEY配置正确
3. 检查网络连接

### Q4: 生成题目很慢
**原因**：AI生成需要时间

**预期耗时**：
- 提炼知识点：3-5秒
- 生成2道选择题：8-12秒
- 生成5道题（混合）：20-30秒

---

## 📊 完整示例数据

### 错题数据示例
```json
{
  "question_text": "求导数 f(x) = x³ + 2x",
  "wrong_answer": "f'(x) = x² + 2",
  "ai_analysis": "[MISTAKE_DETECTED] 错误！x³的导数是3x²，不是x²。正确答案是 f'(x) = 3x² + 2",
  "subject": "数学",
  "knowledge_points": ["导数", "幂函数求导"],
  "difficulty": 3
}
```

### 生成题目请求示例
```json
{
  "knowledge_points": ["导数", "幂函数求导"],
  "difficulty": "中等",
  "question_types": {
    "选择题": 2,
    "填空题": 1,
    "解答题": 1
  },
  "subject": "数学"
}
```

---

## 🎯 快速测试命令（复制即用）

```bash
# 运行完整测试
cd backend
python test_feature3_question_gen.py

# 或者分步运行测试
python test_feature1_auth.py      # Feature 1: 创建用户
python test_feature2_mistakes.py  # Feature 2: 创建错题
python test_feature3_question_gen.py  # Feature 3: 生成题目
```

---

**推荐方式**：先运行测试脚本看效果，熟悉流程后再用API手动操作！

**API文档地址**：http://127.0.0.1:8000/docs 📚

