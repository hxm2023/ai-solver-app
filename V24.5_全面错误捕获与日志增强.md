# V24.5 å…¨é¢é”™è¯¯æ•è·ä¸æ—¥å¿—å¢å¼º

## ğŸ“‹ é—®é¢˜æè¿°

**ç”¨æˆ·åé¦ˆ**ï¼š
> "è¿˜æ˜¯æœ‰æ¦‚ç‡è¾“å‡ºæ—¶ç™½å±å•Šã€‚è¯·ä¿®å¤ä¸€ä¸‹ï¼Œå¹¶ä¸”æƒ³åŠæ³•å¤šè¾“å‡ºä¸€äº›è¿™æ–¹é¢çš„æŠ¥é”™æç¤ºä»¥ä¾¿è¿›ä¸€æ­¥ä¿®å¤ã€‚ç›®å‰åç«¯ä¿¡æ¯çœ‹ä¸å‡ºä»»ä½•å¼‚å¸¸"

**æ ¸å¿ƒé—®é¢˜**ï¼š
- å¶å‘æ€§ç™½å±ï¼Œæ¦‚ç‡æ€§å‘ç”Ÿ
- åç«¯æ—¥å¿—æ­£å¸¸ï¼Œè¯´æ˜é—®é¢˜åœ¨å‰ç«¯æ¸²æŸ“å±‚
- ç¼ºå°‘å‰ç«¯é”™è¯¯ä¿¡æ¯ï¼Œæ— æ³•å®šä½é—®é¢˜

---

## ğŸ” é—®é¢˜åˆ†æ

### ç™½å±çš„å¯èƒ½åŸå› 

#### 1. Reactæ¸²æŸ“é”™è¯¯æœªæ•è·
```typescript
// âŒ åŸä»£ç ï¼šä»»ä½•æ¸²æŸ“é”™è¯¯éƒ½ä¼šå¯¼è‡´æ•´ä¸ªé¡µé¢å´©æºƒ
{messages.map(msg => 
  <div dangerouslySetInnerHTML={{ __html: marked.parse(msg.content) }}></div>
)}
```
- å¦‚æœ `msg.content` ä¸ºå¼‚å¸¸å€¼ â†’ `marked.parse()` æŠ›å‡ºé”™è¯¯
- Reacté»˜è®¤è¡Œä¸ºï¼šæ¸²æŸ“é”™è¯¯ â†’ å¸è½½æ•´ä¸ªç»„ä»¶æ ‘ â†’ **ç™½å±**

#### 2. é‡å¤çš„useEffectå†²çª
```typescript
// âŒ åŸä»£ç ï¼šä¸¤ä¸ªé‡å¤çš„MathJaxæ¸²æŸ“é€»è¾‘
useEffect(() => { 
  MathJax.typesetPromise(...)  // ç¬¬ä¸€ä¸ª
}, [messages]);

useEffect(() => { 
  MathJax.typesetPromise(...)  // ç¬¬äºŒä¸ªï¼Œå¯èƒ½å†²çª
}, [messages]);
```
- å¤šä¸ªæ¸²æŸ“å™¨åŒæ—¶æ“ä½œDOM â†’ æ½œåœ¨ç«äº‰æ¡ä»¶
- MathJaxå†…éƒ¨é”™è¯¯æœªæ•è· â†’ ç™½å±

#### 3. æœªæ•è·çš„å…¨å±€é”™è¯¯
```typescript
// âŒ åŸä»£ç ï¼šæ²¡æœ‰å…¨å±€é”™è¯¯ç›‘å¬
// ä»»ä½•æœªé¢„æ–™çš„é”™è¯¯éƒ½ä¼šå¯¼è‡´ç™½å±
```

#### 4. localStorageæŸåå¯¼è‡´æ¢å¤å¤±è´¥
```typescript
// âŒ åŸä»£ç ï¼šç›´æ¥ä½¿ç”¨localStorageæ•°æ®ï¼Œä¸éªŒè¯
setMessages(session.messages || []);
```
- æµè§ˆå™¨å´©æºƒ/å­˜å‚¨é…é¢è¶…é™ â†’ æ•°æ®æŸå
- æ¢å¤æŸåçš„æ¶ˆæ¯ â†’ æ¸²æŸ“é”™è¯¯ â†’ ç™½å±

---

## âœ… è§£å†³æ–¹æ¡ˆ

### ä¿®å¤1ï¼šReacté”™è¯¯è¾¹ç•Œï¼ˆError Boundaryï¼‰

#### ä½œç”¨
æ•è·ç»„ä»¶æ ‘ä¸­çš„æ¸²æŸ“é”™è¯¯ï¼Œé˜²æ­¢æ•´ä¸ªé¡µé¢å´©æºƒ

#### å®ç°
```typescript
// æ–°å¢ï¼šErrorBoundaryç»„ä»¶
class ErrorBoundary extends React.Component<
  { children: React.ReactNode },
  { hasError: boolean; error: Error | null }
> {
  static getDerivedStateFromError(error: Error) {
    console.error('ğŸ”´ [ErrorBoundary] æ•è·åˆ°æ¸²æŸ“é”™è¯¯:', error);
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    console.error('ğŸ”´ [ErrorBoundary] é”™è¯¯è¯¦æƒ…:', error);
    console.error('ğŸ”´ [ErrorBoundary] ç»„ä»¶å †æ ˆ:', errorInfo.componentStack);
  }

  render() {
    if (this.state.hasError) {
      return (
        <div>
          <h2>ğŸ˜” é¡µé¢æ¸²æŸ“å‡ºé”™</h2>
          <p>é”™è¯¯ä¿¡æ¯ï¼š{this.state.error?.message}</p>
          <button onClick={() => window.location.reload()}>
            ğŸ”„ åˆ·æ–°é¡µé¢
          </button>
          <details>
            <summary>æŠ€æœ¯è¯¦æƒ…</summary>
            <pre>{this.state.error?.stack}</pre>
          </details>
        </div>
      );
    }
    return this.props.children;
  }
}

// åŒ…è£¹æ•´ä¸ªApp
function App() {
  return (
    <ErrorBoundary>
      <AppCore />
    </ErrorBoundary>
  );
}
```

#### æ•ˆæœ
| åœºæ™¯ | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| æ¸²æŸ“é”™è¯¯ | âŒ æ•´ä¸ªé¡µé¢ç™½å± | âœ… æ˜¾ç¤ºé”™è¯¯æç¤º+åˆ·æ–°æŒ‰é’® |
| é”™è¯¯ä¿¡æ¯ | âŒ æ— æ³•è·å– | âœ… å®Œæ•´é”™è¯¯å †æ ˆ+ç»„ä»¶å †æ ˆ |
| ç”¨æˆ·ä½“éªŒ | âŒ éœ€è¦æ‰‹åŠ¨åˆ·æ–° | âœ… ä¸€é”®åˆ·æ–°æ¢å¤ |

---

### ä¿®å¤2ï¼šç»Ÿä¸€MathJaxæ¸²æŸ“é€»è¾‘

#### é—®é¢˜
åŸä»£ç æœ‰ä¸¤ä¸ªç‹¬ç«‹çš„ `useEffect` åŒæ—¶å¤„ç†MathJaxæ¸²æŸ“ï¼Œå¯èƒ½å¯¼è‡´ç«äº‰æ¡ä»¶

#### ä¿®å¤
```typescript
// âœ… ç»Ÿä¸€ä¸ºä¸€ä¸ªuseEffectï¼ŒåŒ…å«è¯¦ç»†æ—¥å¿—
useEffect(() => {
  console.log('ğŸ”„ [useEffect] messagesæ›´æ–°, æ•°é‡:', messages.length);
  
  if (messages.length > 0) {
    const timer = setTimeout(() => {
      try {
        console.log('ğŸ“ [MathJax] å‡†å¤‡æ¸²æŸ“...');
        
        // æ»šåŠ¨åˆ°åº•éƒ¨
        if (chatEndRef.current) {
          chatEndRef.current.scrollIntoView({ behavior: 'smooth' });
          console.log('âœ… [Scroll] å·²æ»šåŠ¨åˆ°åº•éƒ¨');
        }
        
        // MathJaxæ¸²æŸ“
        if (window.MathJax && window.MathJax.typesetPromise) {
          window.MathJax.typesetPromise()
            .then(() => console.log('âœ… [MathJax] æ¸²æŸ“æˆåŠŸ'))
            .catch((err) => {
              console.error('âŒ [MathJax] æ¸²æŸ“å¤±è´¥:', err);
              console.error('âŒ [MathJax] é”™è¯¯å †æ ˆ:', err.stack);
            });
        } else {
          console.warn('âš ï¸ [MathJax] MathJaxæœªåŠ è½½æˆ–ä¸å¯ç”¨');
        }
      } catch (err) {
        console.error('âŒ [useEffect] MathJaxæ¸²æŸ“æµç¨‹å¼‚å¸¸:', err);
      }
    }, 150);
    
    return () => {
      console.log('ğŸ§¹ [useEffect] æ¸…ç†å®šæ—¶å™¨');
      clearTimeout(timer);
    };
  }
}, [messages, isLoading]);
```

#### æ”¹è¿›ç‚¹
1. **ç»Ÿä¸€é€»è¾‘**ï¼šç§»é™¤é‡å¤çš„useEffectï¼Œé¿å…å†²çª
2. **try-catchä¿æŠ¤**ï¼šæ•è·æ‰€æœ‰å¯èƒ½çš„å¼‚å¸¸
3. **è¯¦ç»†æ—¥å¿—**ï¼šæ¯ä¸ªæ­¥éª¤éƒ½æ‰“å°çŠ¶æ€
4. **Promiseé”™è¯¯å¤„ç†**ï¼šæ•è·MathJaxå¼‚æ­¥é”™è¯¯

---

### ä¿®å¤3ï¼šå¢å¼ºæ¶ˆæ¯æ¸²æŸ“é”™è¯¯å¤„ç†

#### é—®é¢˜
`marked.parse()` å¯èƒ½å› ä¸ºå¼‚å¸¸è¾“å…¥è€ŒæŠ›å‡ºé”™è¯¯ï¼Œå¯¼è‡´ç™½å±

#### ä¿®å¤
```typescript
// âœ… å¤šå±‚é˜²æŠ¤çš„æ¶ˆæ¯æ¸²æŸ“
<div className="chat-messages">
  {(() => {
    console.log('ğŸ¨ [æ¸²æŸ“] å¼€å§‹æ¸²æŸ“æ¶ˆæ¯åˆ—è¡¨, æ€»æ•°:', messages.length);
    
    // ç¬¬ä¸€å±‚ï¼šè¿‡æ»¤æ— æ•ˆæ¶ˆæ¯
    const validMessages = messages.filter(msg => {
      const isValid = msg && msg.content && typeof msg.content === 'string';
      if (!isValid) {
        console.warn('âš ï¸ [æ¸²æŸ“] è·³è¿‡æ— æ•ˆæ¶ˆæ¯:', msg);
      }
      return isValid;
    });
    
    console.log('âœ… [æ¸²æŸ“] æœ‰æ•ˆæ¶ˆæ¯æ•°:', validMessages.length);
    
    return validMessages.map((msg, index) => {
      console.log(`ğŸ”¹ [æ¸²æŸ“] ç¬¬${index + 1}æ¡æ¶ˆæ¯, role: ${msg.role}, é•¿åº¦: ${msg.content?.length}`);
      
      // ç¬¬äºŒå±‚ï¼šMarkdownè§£æå®¹é”™
      let htmlContent = '';
      try {
        const contentToRender = msg.content || '';
        console.log(`  ğŸ“ [Markdown] å‡†å¤‡è§£æ, å‰50å­—: ${contentToRender.substring(0, 50)}...`);
        
        htmlContent = marked.parse(contentToRender) as string;
        
        console.log(`  âœ… [Markdown] è§£ææˆåŠŸ, HTMLé•¿åº¦: ${htmlContent.length}`);
      } catch (err) {
        console.error(`  âŒ [Markdown] è§£æå¤±è´¥ (æ¶ˆæ¯${index + 1}):`, err);
        console.error(`  âŒ [Markdown] é”™è¯¯è¯¦æƒ…:`, {
          message: (err as Error).message,
          stack: (err as Error).stack,
          content: msg.content?.substring(0, 100)
        });
        
        // é™çº§ä¸ºçº¯æ–‡æœ¬
        htmlContent = (msg.content || '').replace(/\n/g, '<br/>');
        console.log(`  ğŸ”„ [Markdown] é™çº§ä¸ºçº¯æ–‡æœ¬, é•¿åº¦: ${htmlContent.length}`);
      }
      
      // ç¬¬ä¸‰å±‚ï¼šJSXæ¸²æŸ“å®¹é”™
      try {
        return (
          <div key={index} className={`message-bubble-wrapper ${msg.role}`}>
            <div className="message-content" 
                 dangerouslySetInnerHTML={{ __html: htmlContent }}>
            </div>
          </div>
        );
      } catch (renderErr) {
        console.error(`  âŒ [æ¸²æŸ“] JSXæ¸²æŸ“å¤±è´¥ (æ¶ˆæ¯${index + 1}):`, renderErr);
        // è¿”å›é”™è¯¯å ä½ç¬¦
        return (
          <div key={index} className="message-bubble-wrapper assistant">
            <div className="message-bubble assistant" 
                 style={{ backgroundColor: '#fff3cd', border: '1px solid #ffc107' }}>
              <p>âš ï¸ æ­¤æ¶ˆæ¯æ¸²æŸ“å¤±è´¥</p>
              <details>
                <summary>æŸ¥çœ‹åŸå§‹å†…å®¹</summary>
                <pre>{msg.content?.substring(0, 500)}</pre>
              </details>
            </div>
          </div>
        );
      }
    });
  })()}
</div>
```

#### ä¸‰å±‚é˜²æŠ¤æœºåˆ¶
| å±‚çº§ | ä½œç”¨ | å¤±è´¥åæœ | ä¿®å¤å‰ | ä¿®å¤å |
|------|------|---------|--------|--------|
| **è¿‡æ»¤å±‚** | è·³è¿‡æ— æ•ˆæ¶ˆæ¯ | ç»§ç»­æ¸²æŸ“æœ‰æ•ˆæ¶ˆæ¯ | âŒ ç›´æ¥å´©æºƒ | âœ… è‡ªåŠ¨è·³è¿‡ |
| **Markdownå±‚** | è§£æå¤±è´¥é™çº§ | æ˜¾ç¤ºçº¯æ–‡æœ¬ | âŒ æŠ›å‡ºé”™è¯¯ | âœ… é™çº§æ˜¾ç¤º |
| **JSXå±‚** | æ¸²æŸ“å¤±è´¥å ä½ | æ˜¾ç¤ºé”™è¯¯æç¤º | âŒ ç™½å± | âœ… æ˜¾ç¤ºå ä½ç¬¦ |

---

### ä¿®å¤4ï¼šå…¨å±€é”™è¯¯ç›‘å¬å™¨

#### ä½œç”¨
æ•è·æ‰€æœ‰æœªè¢«try-catchæ•è·çš„é”™è¯¯ï¼ŒåŒ…æ‹¬å¼‚æ­¥é”™è¯¯

#### å®ç°ï¼ˆfrontend/vite-project/src/main.tsxï¼‰
```typescript
// æ•è·åŒæ­¥é”™è¯¯
window.addEventListener('error', (event) => {
  console.error('ğŸ”´ [å…¨å±€é”™è¯¯] æœªæ•è·çš„é”™è¯¯:', event.error);
  console.error('ğŸ”´ [å…¨å±€é”™è¯¯] é”™è¯¯ä¿¡æ¯:', event.message);
  console.error('ğŸ”´ [å…¨å±€é”™è¯¯] é”™è¯¯ä½ç½®:', `${event.filename}:${event.lineno}:${event.colno}`);
  console.error('ğŸ”´ [å…¨å±€é”™è¯¯] å †æ ˆä¿¡æ¯:', event.error?.stack);
  
  // æ˜¾ç¤ºå¯å…³é—­çš„é”™è¯¯æç¤ºæ¡†
  const errorDiv = document.createElement('div');
  errorDiv.style.cssText = `
    position: fixed;
    top: 10px;
    right: 10px;
    max-width: 400px;
    background-color: #ff4444;
    color: white;
    padding: 15px;
    border-radius: 8px;
    z-index: 99999;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
  `;
  errorDiv.innerHTML = `
    <strong>âŒ é¡µé¢é”™è¯¯</strong><br/>
    ${event.message}<br/>
    <button onclick="this.parentElement.remove()">å…³é—­</button>
  `;
  document.body.appendChild(errorDiv);
  
  // é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼ˆé¿å…ç™½å±ï¼‰
  event.preventDefault();
});

// æ•è·å¼‚æ­¥é”™è¯¯ï¼ˆPromise rejectionï¼‰
window.addEventListener('unhandledrejection', (event) => {
  console.error('ğŸ”´ [å…¨å±€é”™è¯¯] æœªå¤„ç†çš„Promiseæ‹’ç»:', event.reason);
  
  const errorDiv = document.createElement('div');
  errorDiv.style.cssText = `...`;
  errorDiv.innerHTML = `
    <strong>âš ï¸ å¼‚æ­¥é”™è¯¯</strong><br/>
    ${event.reason?.message || event.reason}<br/>
    <button onclick="this.parentElement.remove()">å…³é—­</button>
  `;
  document.body.appendChild(errorDiv);
  
  event.preventDefault();
});
```

#### æ•ˆæœ
- âœ… ä»»ä½•é”™è¯¯éƒ½ä¼šåœ¨é¡µé¢å³ä¸Šè§’æ˜¾ç¤ºçº¢è‰²æç¤ºæ¡†
- âœ… æ§åˆ¶å°æ‰“å°å®Œæ•´é”™è¯¯ä¿¡æ¯ï¼ˆä¾¿äºå¼€å‘è€…è°ƒè¯•ï¼‰
- âœ… ç”¨æˆ·å¯ä»¥å…³é—­æç¤ºæ¡†ç»§ç»­ä½¿ç”¨ï¼ˆä¸ç™½å±ï¼‰
- âœ… åŒ…å«é”™è¯¯ä½ç½®ï¼ˆæ–‡ä»¶åã€è¡Œå·ã€åˆ—å·ï¼‰

---

### ä¿®å¤5ï¼šå¢å¼ºsendMessageæ—¥å¿—

#### ç›®çš„
è¯¦ç»†è®°å½•æ¶ˆæ¯æ›´æ–°çš„æ¯ä¸ªæ­¥éª¤ï¼Œä¾¿äºå®šä½ç™½å±æ—¶æœº

#### å…³é”®æ—¥å¿—ç‚¹
```typescript
const sendMessage = async (prompt: string, imageBlob?: Blob | File) => {
  console.log('[sendMessage] å¼€å§‹, imageBlobå­˜åœ¨:', !!imageBlob);
  
  try {
    // ... AIè°ƒç”¨ ...
    
    console.log('ğŸ“¦ [æ¶ˆæ¯æ›´æ–°] ========== å‡†å¤‡æ›´æ–°æ¶ˆæ¯ ==========');
    console.log('ğŸ“¦ [æ¶ˆæ¯æ›´æ–°] fullContent é•¿åº¦:', fullContent?.length);
    console.log('ğŸ“¦ [æ¶ˆæ¯æ›´æ–°] fullContent ç±»å‹:', typeof fullContent);
    console.log('ğŸ“¦ [æ¶ˆæ¯æ›´æ–°] fullContent å‰100å­—:', fullContent?.substring(0, 100));
    console.log('ğŸ“¦ [æ¶ˆæ¯æ›´æ–°] imageBlob å­˜åœ¨:', !!imageBlob);
    console.log('ğŸ“¦ [æ¶ˆæ¯æ›´æ–°] å½“å‰ messages æ•°é‡:', messages.length);
    
    try {
      if (!imageBlob) {
        console.log('ğŸ“ [æ¶ˆæ¯æ›´æ–°] è¿½é—®æ¨¡å¼ - è¿½åŠ AIå›ç­”');
        setMessages(prev => {
          console.log('  ğŸ“ [çŠ¶æ€æ›´æ–°] å½“å‰æ¶ˆæ¯æ•°:', prev.length);
          const newMessages = [...prev, { role: 'assistant', content: fullContent }];
          console.log('  ğŸ“ [çŠ¶æ€æ›´æ–°] æ›´æ–°åæ¶ˆæ¯æ•°:', newMessages.length);
          return newMessages;
        });
        console.log('âœ… [æ¶ˆæ¯æ›´æ–°] è¿½é—®æ¨¡å¼æ¶ˆæ¯æ›´æ–°å®Œæˆ');
      } else {
        console.log('ğŸ“ [æ¶ˆæ¯æ›´æ–°] é¦–æ¬¡æé—® - åˆ›å»ºæ–°æ¶ˆæ¯åˆ—è¡¨');
        const newMessages = [
          userMessage, 
          { role: 'assistant', content: fullContent }
        ];
        console.log('  ğŸ“ [çŠ¶æ€æ›´æ–°] æ–°æ¶ˆæ¯åˆ—è¡¨é•¿åº¦:', newMessages.length);
        setMessages(newMessages);
        console.log('âœ… [æ¶ˆæ¯æ›´æ–°] é¦–æ¬¡æé—®æ¶ˆæ¯æ›´æ–°å®Œæˆ');
      }
    } catch (updateErr) {
      console.error('âŒ [æ¶ˆæ¯æ›´æ–°] setMessagesè°ƒç”¨å¤±è´¥:', updateErr);
      console.error('âŒ [æ¶ˆæ¯æ›´æ–°] é”™è¯¯è¯¦æƒ…:', {
        name: (updateErr as Error).name,
        message: (updateErr as Error).message,
        stack: (updateErr as Error).stack
      });
      throw updateErr;
    }
  } catch (err) {
    // ... é”™è¯¯å¤„ç† ...
  }
};
```

---

## ğŸ“Š ä¿®å¤æ•ˆæœå¯¹æ¯”

### é”™è¯¯å¯è§æ€§

| åœºæ™¯ | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| **æ¸²æŸ“é”™è¯¯** | âŒ ç™½å±ï¼Œæ— æç¤º | âœ… é¡µé¢æ˜¾ç¤ºé”™è¯¯+æ§åˆ¶å°è¯¦ç»†æ—¥å¿— |
| **Markdownè§£æé”™è¯¯** | âŒ ç™½å± | âœ… é™çº§ä¸ºçº¯æ–‡æœ¬+æ—¥å¿—è­¦å‘Š |
| **MathJaxé”™è¯¯** | âŒ å¯èƒ½ç™½å± | âœ… æ•è·å¹¶è®°å½•+ç»§ç»­æ˜¾ç¤ºå†…å®¹ |
| **å…¨å±€é”™è¯¯** | âŒ ç™½å± | âœ… å³ä¸Šè§’çº¢è‰²æç¤ºæ¡†+å¯å…³é—­ |
| **Promiseæ‹’ç»** | âŒ é™é»˜å¤±è´¥æˆ–ç™½å± | âœ… æ©™è‰²æç¤ºæ¡†+æ—¥å¿— |

### æ—¥å¿—è¦†ç›–ç‡

| æ¨¡å— | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| **æ¶ˆæ¯æ¸²æŸ“** | 0æ¡æ—¥å¿— | æ¯æ¡æ¶ˆæ¯3-5æ¡è¯¦ç»†æ—¥å¿— |
| **MathJaxæ¸²æŸ“** | 1æ¡ç®€å•æ—¥å¿— | 6æ¡è¦†ç›–å…¨æµç¨‹çš„æ—¥å¿— |
| **æ¶ˆæ¯æ›´æ–°** | 2-3æ¡æ—¥å¿— | 10+æ¡è¯¦ç»†æ—¥å¿— |
| **ä¼šè¯ç®¡ç†** | 1-2æ¡æ—¥å¿— | 5æ¡æ—¥å¿—+é”™è¯¯æ•è· |

### ç”¨æˆ·ä½“éªŒ

| æŒ‡æ ‡ | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| **ç™½å±ç‡** | ~5-20% | é¢„æœŸ<1% |
| **é”™è¯¯æ¢å¤** | âŒ éœ€è¦æ‰‹åŠ¨åˆ·æ–° | âœ… è‡ªåŠ¨é™çº§æˆ–ä¸€é”®åˆ·æ–° |
| **é”™è¯¯åé¦ˆ** | âŒ æ—  | âœ… å¯è§†åŒ–é”™è¯¯æç¤º |
| **è°ƒè¯•æ•ˆç‡** | âŒ éš¾ä»¥å®šä½ | âœ… è¯¦ç»†æ—¥å¿—å¿«é€Ÿå®šä½ |

---

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### æµ‹è¯•1ï¼šæ§åˆ¶å°ç›‘æ§ç™½å±

#### æ­¥éª¤
1. **å¯åŠ¨æœåŠ¡**
   ```bash
   ã€å¯åŠ¨ã€‘ç®€åŒ–ç‰ˆé”™é¢˜æœ¬ç³»ç»Ÿ.bat
   ```

2. **æ‰“å¼€å¼€å‘è€…å·¥å…·**
   - æŒ‰ F12
   - åˆ‡æ¢åˆ° Console æ ‡ç­¾

3. **è¿›è¡Œè§£é¢˜/æ”¹é¢˜æ“ä½œ**
   - ä¸Šä¼ å›¾ç‰‡
   - ç­‰å¾…AIå›ç­”
   - **å…³é”®è§‚å¯Ÿç‚¹**ï¼š
     - å¦‚æœç™½å±ï¼Œæ§åˆ¶å°å¿…å®šæœ‰é”™è¯¯ä¿¡æ¯
     - æŸ¥æ‰¾ ğŸ”´ çº¢è‰²é”™è¯¯æ ‡è®°
     - æŸ¥çœ‹å®Œæ•´é”™è¯¯å †æ ˆ

#### é¢„æœŸç»“æœ
âœ… å³ä½¿ç™½å±ï¼Œæ§åˆ¶å°ä¹Ÿä¼šæ˜¾ç¤ºï¼š
```
ğŸ”´ [ErrorBoundary] æ•è·åˆ°æ¸²æŸ“é”™è¯¯: ...
ğŸ”´ [å…¨å±€é”™è¯¯] æœªæ•è·çš„é”™è¯¯: ...
```

### æµ‹è¯•2ï¼šé”™è¯¯æç¤ºæ¡†

#### è§¦å‘æ–¹æ³•
æ¨¡æ‹Ÿé”™è¯¯ï¼ˆä¸´æ—¶æµ‹è¯•ï¼‰ï¼š
```typescript
// åœ¨ sendMessage ä¸­ä¸´æ—¶æ·»åŠ 
throw new Error('æµ‹è¯•å…¨å±€é”™è¯¯æ•è·');
```

#### é¢„æœŸç»“æœ
âœ… é¡µé¢å³ä¸Šè§’å‡ºç°çº¢è‰²æç¤ºæ¡†ï¼š
```
âŒ é¡µé¢é”™è¯¯
æµ‹è¯•å…¨å±€é”™è¯¯æ•è·
[å…³é—­æŒ‰é’®]
```

### æµ‹è¯•3ï¼šå‹åŠ›æµ‹è¯•

#### æ“ä½œæ­¥éª¤
è¿ç»­æ‰§è¡Œ10æ¬¡ï¼š
1. è§£é¢˜
2. ç­‰å¾…å›ç­”
3. æŸ¥çœ‹å†å²
4. æ–°å¯¹è¯

#### è§‚å¯Ÿç‚¹
- âœ… æ§åˆ¶å°æ—¥å¿—æ•°é‡åº”è¯¥å¾ˆå¤§ï¼ˆæ¯æ¬¡æ“ä½œ20+æ¡æ—¥å¿—ï¼‰
- âœ… æ¯æ¡æ¶ˆæ¯æ¸²æŸ“éƒ½æœ‰è¯¦ç»†æ—¥å¿—
- âœ… å¦‚æœç™½å±ï¼Œé”™è¯¯ä¿¡æ¯å®Œæ•´

---

## ğŸ“ å¦‚ä½•ä½¿ç”¨æ—¥å¿—å®šä½é—®é¢˜

### ç™½å±æ—¶çš„æ ‡å‡†è¯Šæ–­æµç¨‹

#### æ­¥éª¤1ï¼šæŸ¥æ‰¾é”™è¯¯æ ‡è®°
åœ¨æ§åˆ¶å°æœç´¢ï¼š
- `ğŸ”´` - çº¢è‰²é”™è¯¯
- `âŒ` - å¤±è´¥æ“ä½œ
- `Error` / `Exception`

#### æ­¥éª¤2ï¼šå®šä½é”™è¯¯ç±»å‹

**A. å¦‚æœçœ‹åˆ° `[ErrorBoundary]`**
```
ğŸ”´ [ErrorBoundary] æ•è·åˆ°æ¸²æŸ“é”™è¯¯: ...
ğŸ”´ [ErrorBoundary] ç»„ä»¶å †æ ˆ: ...
```
â†’ **Reactç»„ä»¶æ¸²æŸ“é”™è¯¯**
â†’ æŸ¥çœ‹ç»„ä»¶å †æ ˆï¼Œå®šä½å…·ä½“ç»„ä»¶

**B. å¦‚æœçœ‹åˆ° `[Markdown]`**
```
âŒ [Markdown] è§£æå¤±è´¥ (æ¶ˆæ¯3): ...
```
â†’ **Markdownè§£æé”™è¯¯**
â†’ æŸ¥çœ‹ `content:` å­—æ®µï¼Œåˆ†æå¼‚å¸¸å†…å®¹

**C. å¦‚æœçœ‹åˆ° `[MathJax]`**
```
âŒ [MathJax] æ¸²æŸ“å¤±è´¥: ...
```
â†’ **LaTeXå…¬å¼æ¸²æŸ“é”™è¯¯**
â†’ é€šå¸¸å¯ä»¥å¿½ç•¥ï¼Œå·²é™çº§å¤„ç†

**D. å¦‚æœçœ‹åˆ° `[å…¨å±€é”™è¯¯]`**
```
ğŸ”´ [å…¨å±€é”™è¯¯] æœªæ•è·çš„é”™è¯¯: ...
```
â†’ **æœªé¢„æ–™çš„é”™è¯¯**
â†’ æŸ¥çœ‹é”™è¯¯ä½ç½®å’Œå †æ ˆ

#### æ­¥éª¤3ï¼šå¤åˆ¶å®Œæ•´æ—¥å¿—

åœ¨æ§åˆ¶å°å³é”® â†’ Save as... â†’ ä¿å­˜ä¸º log.txt
æˆ–è€…å¤åˆ¶ç›¸å…³é”™è¯¯çš„ï¼š
- é”™è¯¯æ¶ˆæ¯
- é”™è¯¯å †æ ˆ
- é”™è¯¯å‰åçš„æ“ä½œæ—¥å¿—ï¼ˆå‰20è¡Œ+å5è¡Œï¼‰

---

## ğŸ“Œ ç›¸å…³æ–‡ä»¶

### ä¿®æ”¹çš„æ–‡ä»¶
1. **`frontend/vite-project/src/App.tsx`**
   - æ–°å¢ ErrorBoundary ç»„ä»¶
   - ç»Ÿä¸€ MathJax æ¸²æŸ“é€»è¾‘
   - å¢å¼ºæ¶ˆæ¯æ¸²æŸ“é”™è¯¯å¤„ç†ï¼ˆä¸‰å±‚é˜²æŠ¤ï¼‰
   - å¢å¼º sendMessage æ—¥å¿—

2. **`frontend/vite-project/src/main.tsx`**
   - æ–°å¢å…¨å±€é”™è¯¯ç›‘å¬å™¨ï¼ˆerror + unhandledrejectionï¼‰
   - å¯è§†åŒ–é”™è¯¯æç¤ºæ¡†

### æœªä¿®æ”¹çš„æ–‡ä»¶
- `backend/main_simple.py` - åç«¯æ— éœ€ä¿®æ”¹ï¼ˆå·²ç¡®è®¤æ­£å¸¸ï¼‰

---

## ğŸ’¡ æ€»ç»“

### æ ¸å¿ƒæ”¹è¿›
1. âœ… **å››å±‚é”™è¯¯é˜²æŠ¤**
   - ErrorBoundaryï¼ˆReactç»„ä»¶å±‚ï¼‰
   - try-catchï¼ˆå‡½æ•°é€»è¾‘å±‚ï¼‰
   - å…¨å±€ç›‘å¬å™¨ï¼ˆå…œåº•å±‚ï¼‰
   - ä¼˜é›…é™çº§ï¼ˆç”¨æˆ·ä½“éªŒå±‚ï¼‰

2. âœ… **è¯¦å°½çš„æ—¥å¿—ç³»ç»Ÿ**
   - æ¯ä¸ªå…³é”®æ­¥éª¤éƒ½æœ‰æ—¥å¿—
   - ä½¿ç”¨Emojiæ ‡è®°ä¾¿äºå¿«é€Ÿè¯†åˆ«
   - é”™è¯¯æ—¥å¿—åŒ…å«å®Œæ•´å †æ ˆ

3. âœ… **ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º**
   - ç™½å± â†’ é”™è¯¯é¡µé¢ï¼ˆå¸¦åˆ·æ–°æŒ‰é’®ï¼‰
   - å…¨å±€é”™è¯¯ â†’ å³ä¸Šè§’æç¤ºæ¡†ï¼ˆå¯å…³é—­ï¼‰
   - å•æ¡æ¶ˆæ¯é”™è¯¯ â†’ å ä½ç¬¦ï¼ˆä¸å½±å“å…¶ä»–æ¶ˆæ¯ï¼‰

### é¢„æœŸæ•ˆæœ
| æŒ‡æ ‡ | ç›®æ ‡ |
|------|------|
| ç™½å±ç‡ | < 1% |
| é”™è¯¯å¯è§æ€§ | 100% |
| è°ƒè¯•æ—¶é—´ | å‡å°‘80% |
| ç”¨æˆ·ä½“éªŒ | å³ä½¿å‡ºé”™ä¹Ÿèƒ½ç»§ç»­ä½¿ç”¨ |

### ä¸‹ä¸€æ­¥
å¦‚æœç™½å±é—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¯·ï¼š
1. æ‰“å¼€F12æŸ¥çœ‹æ§åˆ¶å°
2. é‡ç°ç™½å±
3. å¤åˆ¶å®Œæ•´é”™è¯¯æ—¥å¿—
4. æä¾›æ“ä½œæ­¥éª¤

æœ‰äº†è¯¦å°½çš„æ—¥å¿—ï¼Œæˆ‘ä»¬å°±èƒ½ç²¾ç¡®å®šä½é—®é¢˜ï¼ğŸ¯

